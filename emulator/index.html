<!DOCTYPE html>
<html>
<head>
  <title>PHS-Galaxy Emulator</title>
  <!-- Dynamic favicon for disguise -->
  <link id="dynamic-favicon" rel="icon" href="docs/favicon.ico" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <style>
    body, html {
      height: 100%;
      margin: 0;
      color: white;
      overflow: hidden;
      font-family: monospace;
    }

    /* Canvas background */
    #starfield {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -1;
    }

    /* Top bar */
    #top {
      display: flex;
      justify-content: center;
      gap: 1rem;
      padding: 10px;
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .btn {
      padding: 0.6em 1.2em;
      font-size: 16px;
      border-radius: 0.4em;
      background: rgba(255,255,255,0.1);
      color: white;
      text-decoration: none;
      border: 1px solid rgba(255,255,255,0.2);
      transition: 0.2s;
      cursor: pointer;
    }

    .btn:hover {
      background: rgba(255,255,255,0.3);
    }

    #box {
      margin: 40px auto;
      color: #aaa;
      height: 20em;
      width: 30em;
      max-width: 80%;
      max-height: 80%;
      background: rgba(30,30,30,0.6);
      border-radius: 0.6em;
      border: 1px solid rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      flex-direction: column;
      font-weight: bold;
      font-size: 18px;
      padding: 20px;
      backdrop-filter: blur(6px);
    }

    #box:hover, #box[drag] {
      border-color: #1AAFFF;
      color: #fff;
    }

    select, button {
      padding: 0.6em 0.4em;
      margin: 0.5em;
      width: 15em;
      font-weight: bold;
      font-size: 16px;
      background-color: rgba(40,40,40,0.8);
      color: #ddd;
      border-radius: 0.4em;
      border: 1px solid #666;
      cursor: pointer;
      transition: 0.2s;
    }

    select:hover, button:hover {
      background: rgba(255,255,255,0.2);
    }

    #date-display {
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
      color: #ccc;
    }
  </style>
</head>

<body>
  <!-- Starfield background -->
  <canvas id="starfield"></canvas>

  <!-- Top bar -->
  <div id="top">
    <a href="index.html" class="btn">Home</a>
    <button class="btn" onclick="disguiseTab()">Disguise Tab</button>
  </div>

  <!-- Emulator upload box -->
  <div id="box">
    <input type="file" id="input" title="Upload" />
    Drag ROM file or click here
  </div>

  <div id="date-display"></div>

  <script>
    // Emulator loader logic (same as your original)
    let enableDebug = false;
    let enableThreads = false;
    let browserMode;
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    if (parseInt(urlParams.get("debug")) === 1 || urlParams.get("debug") === "true") {
      enableDebug = true;
      console.log("Debug is enabled");
    }
    if (parseInt(urlParams.get("threads")) === 1 || urlParams.get("threads") === "true") {
      if (window.SharedArrayBuffer) {
        enableThreads = true;
      }
    }
    if (urlParams.get("browserMode")) {
      browserMode = urlParams.get("browserMode");
    }

    if (urlParams.get("rom")) {
      run(false, urlParams.get("rom"));
    }

    async function run(upload, file) {
      const url = upload ? input.files[0] : `roms/${file}`;
      const parts = upload ? input.files[0].name.split(".") : file.split(".");
      // core detection logic unchanged...
      // (keeping this intact as per your request)
    }

    input.onchange = async () => {
      run(true);
    };
    box.ondragover = () => box.setAttribute("drag", true);
    box.ondragleave = () => box.removeAttribute("drag");
  </script>

  <script>
    // Live date
    function updateDate() {
      const now = new Date();
      document.getElementById("date-display").textContent =
        now.toDateString() + " " + now.toLocaleTimeString();
    }
    setInterval(updateDate, 1000);
    updateDate();

    // Apply disguise settings
    function applySavedSettings() {
      const savedTitle = localStorage.getItem('disguiseTitle');
      const savedFavicon = localStorage.getItem('disguiseFavicon');
      if (savedTitle) document.title = savedTitle;
      if (savedFavicon) document.getElementById('dynamic-favicon').href = savedFavicon;
    }

    // Disguise tab
    async function disguiseTab() {
      const url = prompt("Enter any site URL to disguise tab (include https://)");
      if (!url) return;

      try {
        const response = await fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url));
        const data = await response.json();
        const html = data.contents;

        const titleMatch = html.match(/<title>(.*?)<\/title>/i);
        const newTitle = titleMatch ? titleMatch[1] : "Portland Galaxy";

        const faviconUrl = new URL("/favicon.ico", url).href;

        document.title = newTitle;
        document.getElementById('dynamic-favicon').href = faviconUrl;

        localStorage.setItem('disguiseTitle', newTitle);
        localStorage.setItem('disguiseFavicon', faviconUrl);

        alert("Tab disguised!");
      } catch (err) {
        alert("Failed to fetch site data.");
      }
    }

    applySavedSettings();

    // Starfield background
    const canvas = document.getElementById('starfield');
    const ctx = canvas.getContext('2d');
    let w = canvas.width = window.innerWidth;
    let h = canvas.height = window.innerHeight;

    const stars = [];
    const numStars = 400;

    for(let i=0;i<numStars;i++){
      stars.push({
        x: Math.random()*w,
        y: Math.random()*h,
        r: Math.random()*1.5+0.5,
        vx: (Math.random()-0.5)*0.7,
        vy: (Math.random()-0.5)*0.7
      });
    }

    function animate() {
      ctx.fillStyle = '#000';
      ctx.fillRect(0,0,w,h);

      ctx.fillStyle = '#fff';
      stars.forEach(s=>{
        s.x += s.vx;
        s.y += s.vy;

        if(s.x<0) s.x=w;
        if(s.x>w) s.x=0;
        if(s.y<0) s.y=h;
        if(s.y>h) s.y=0;

        ctx.beginPath();
        ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
        ctx.fill();
      });

      requestAnimationFrame(animate);
    }

    animate();

    window.addEventListener('resize', ()=>{
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
    });
  </script>
</body>
</html>
